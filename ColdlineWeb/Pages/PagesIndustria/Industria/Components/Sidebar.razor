@using ColdlineWeb.Models
@using ColdlineWeb.Models.Config
@using Microsoft.Extensions.Options

@inject IOptions<ServerSettings> ServerOptions

@code {
    [Parameter] public UserModel? User { get; set; }
    [Parameter] public List<MachineModel> StoppedMachines { get; set; } = new(); 
    [Parameter] public EventCallback OnLogout { get; set; }

    // ðŸ”¹ Callback para o pai (Industria)
    [Parameter] public EventCallback<string> OnResumeMachine { get; set; }

    // ðŸ”¹ Base da API vinda do appsettings.json
    private string ApiBaseUrl => ServerOptions?.Value?.ApiBaseUrl?.TrimEnd('/') ?? string.Empty;
}

<div class="sidebar">
    @if (User != null)
    {
        <div class="user-avatar">
            <img src="@($"{ApiBaseUrl}/uploads/{User.UrlPhoto}?t={DateTime.UtcNow.Ticks}")"
                 alt="Foto do UsuÃ¡rio" width="80"
                 onerror="this.onerror=null; this.src='https://via.placeholder.com/80';">
        </div>

        <div class="user-info">
            <h5>@User.Name</h5>
            <p>@User.Department?.Name</p>
            <p>@(User.CurrentProcess != null ? User.CurrentProcess.Name : "NÃ£o hÃ¡ progresso existente")</p>
            <p>@(User.CurrentOccurrence != null ? User.CurrentOccurrence.Name : "NÃ£o hÃ¡ ocorrÃªncia")</p>
        </div>
    }

    <div class="sidebar-logo">
        <img src="img/logo.png" alt="Logo Coldline">
    </div>

    <button class="btn-circle" @onclick="() => OnLogout.InvokeAsync()">
        <i class="fas fa-arrow-left"></i>
    </button>
</div>
