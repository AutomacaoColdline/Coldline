@using ColdlineWeb.Models

@code {
    [Parameter] public UserModel? User { get; set; }
    [Parameter] public List<MachineModel> StoppedMachines { get; set; } = new(); 
    [Parameter] public EventCallback OnLogout { get; set; }

    // ðŸ”¹ NOVO: callback para o pai (Industria)
    [Parameter] public EventCallback<string> OnResumeMachine { get; set; }
}

<div class="sidebar">
    @if (User != null)
    {
        <div class="user-avatar">
            <img src="@($"http://10.0.0.44:5000/uploads/{User.UrlPhoto}?t={DateTime.UtcNow.Ticks}")"
                 alt="Foto do UsuÃ¡rio" width="80"
                 onerror="this.onerror=null; this.src='https://via.placeholder.com/80';">
        </div>

        <div class="user-info">
            <h5>@User.Name</h5>
            <p>@User.Department?.Name</p>
            <p>@(User.CurrentProcess != null ? User.CurrentProcess.Name : "NÃ£o hÃ¡ progresso existente")</p>
            <p>@(User.CurrentOccurrence != null ? User.CurrentOccurrence.Name : "NÃ£o hÃ¡ ocorrÃªncia")</p>
        </div>

        @if (StoppedMachines?.Count > 0)
        {
            <div class="stopped-machines mt-3">
                <h6>MÃ¡quinas paradas por vocÃª</h6>
                <ul class="stopped-list">
                    @foreach (var m in StoppedMachines)
                    {
                        <li class="stopped-item">
                            <div class="stopped-line">
                                <span class="stopped-type">@(m.MachineType?.Name ?? "MÃ¡quina")</span>
                                <span class="stopped-id">@m.IdentificationNumber</span>
                                <img src="img/stop.png" alt="Parada" class="stopped-icon" />
                                <button class="activate-btn" title="Voltar mÃ¡quina"
                                        @onclick="() => OnResumeMachine.InvokeAsync(m.Id)">
                                    <img src="img/ocorrencia.png" alt="Ativar mÃ¡quina">
                                </button>
                            </div>
                        </li>
                    }
                </ul>
            </div>
        }
    }

    <div class="sidebar-logo">
        <img src="img/logo.png" alt="Logo Coldline">
    </div>

    <button class="btn-circle" @onclick="() => OnLogout.InvokeAsync()">
        <i class="fas fa-arrow-left"></i>
    </button>
</div>
